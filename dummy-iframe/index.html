<!DOCTYPE html>
<html>
  <head>
    <title>Dummy IFrame Test</title>
    <meta charset="utf-8">
    <style>
      .missing {
        background-color: red;
      }
    </style>
  </head>
  <body>
  <iframe name="st-iframe" id="st-iframe" style="display: none;"></iframe>
    <form method="POST" name="st-form" id="st-form" target="st-iframe" id="st-form">
    </form>
    <script src="thirdparty/jquery.min.js"></script>
    <script>

      function getFormElement(item) {

        var $el,
            $outer = $("<div></div>");

        $outer.append("<label>" + item.name + "</label>");

        if (item.type == "textarea") {

          $el = $("<textarea></textarea>")
                  .attr("name",item.field);
        
        } else if (item.type == "select") {
          $el = $("<select></select>")
                  .attr("name",item.field);

          $.each(item.choices,function(i,c){
            
            $el.append(

              $("<option></option>").text(c)

            );

          });

        } else if (item.type == "radio" || item.type == "checkbox") {

          $el = $("<div></div>");

          $.each(item.choices,function(i,c){

            var $i = $("<input/>").attr({
                  "name": item.field,
                  "type": item.type,
                  "value": c
                }),
                $s = $("<span/>").text(c);

            $el.append($i);
            $el.append($s);

          });
        } else {

          $el = $("<input/>").attr({
            "name": item.field,
            "type": item.type,
            "value": ""
          });

        }

        $outer.append($el);

        return $outer;

      }

      function submitted() {
        console.log("form submitted!");
      }

      $.getJSON("sample-form-config.json",function(config){

        var $form = $("form#st-form"),
            $iframe = $("iframe#st-iframe");

        $iframe.on("load",submitted);

        $form.attr("action",config.action)
              .on("submit",function(){

                $(".missing").removeClass("missing");

                var $missing = $.map(config.fields,function(f){

                                var tag = (f.type == "select" || f.type == "textarea") ? f.type : "input",
                                    $tag = $(tag + "[name='" + f.field + "']");



                                if (f.required && (!$tag.val() || !$tag.val().length)) {
                                  return $tag;
                                }

                                return false;

                              });

                $missing = $.grep($missing,function(f){
                  return f !== false;
                });

                if ($missing.length) {

                  $.each($missing,function(i,$m){

                    $m.addClass("missing");

                  });

                  return false;
                }

                return true;

              });

        $.each(config.fields,function(i,f){
          $form.append(getFormElement(f));
        });

        $form.append("<input type=\"submit\" value=\"Submit\"/>");

      });
    </script>
  </body>
</html>